<html>
	<head>
		<title>Audio Analyser</title>
		<style>
		body {
		 margin: 0px;
		}
		.controls {
		 position: absolute;
		 right: 0px;
		 top: 0px;
		 background-color: rgba(0, 0, 0, 0.5);
		 width: 25%;
		 height: 50%;
		}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<audio id="myAudio" src="tracks/High.mp3"></audio>
		<div class="controls">
			<p>Bars</p>
			<input max="250" min="25" id="barAmount" step="1" value="25" type="range"></input>
		</div>
	</body>
	<script>
	let canvas = document.getElementById('canvas');
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
	let c = canvas.getContext('2d');
	let settings = {
		graphics: {
			bars: 25,
		},
		volume: 100,
		speed: 1,
		mode: {
			studio: true,
			record: false,
			preview: false,
		},
	};
	let app = {
		renderFrame: function() {
			 requestAnimationFrame(app.renderFrame);
			 let count = settings.graphics.bars;
			 c.clearRect(0, 0, canvas.width, canvas.height);
			 for (let i = 1; i < settings.graphics.bars + 1; i++) {
			  c.beginPath();
			  c.fillStyle = 'black';
			  if (settings.mode.studio == false) {
			this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount);
				c.rect(window.innerWidth / 2 / count * i, innerHeight, 5, -this.frequencyData[i] * 10);
			  } else {
				c.rect(window.innerWidth / 2 / count * i, innerHeight, 5, -Math.floor(Math.random() * 250));
			  }
			  c.fill();
			  c.closePath();
			 }
		},
		start: function() {
			app.renderFrame();
			this.audioCtx = new AudioContext();
			this.audio = document.getElementById('myAudio');
			this.audioSrc = this.audioCtx.createMediaElementSource(this.audio);
			this.analyser = this.audioCtx.createAnalyser();
			this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount);
			this.audioSrc.connect(this.audioCtx.destination);
			this.audioSrc.connect(this.analyser);
			this.renderFrame();
			setInterval( function() {
				settings.graphics.bars = document.getElementById('barAmount').value;
			}, 100);
		},
		audio: '',
		audioCtx: '',
		analyser: '',
		audioSrc: '',
		frequencyData: '',
	};
	app.start();
	</script>
</html>
