<html>
	<head>
		<title>Audio Analyser</title>
		<style>
		body {
		 margin: 0px;
		}
		.controls {
		 position: absolute;
		 right: 0px;
		 top: 0px;
		 background-color: rgba(0, 0, 0, 0.5);
		 width: 25%;
		 height: 50%;
		}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<audio id="myAudio" src="tracks/High.mp3"></audio>
		<div class="controls">
			<p>Bars</p>
			<input max="250" min="25" id="barAmount" step="1" value="25" type="range"></input>
		</div>
	</body>
	<script>
	let canvas = document.getElementById('canvas');
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
	let c = canvas.getContext('2d');
	let settings = {
		graphics: {
			bars: 25,
		},
		volume: 100,
		speed: 1,
		mode: {
			studio: true,
			record: false,
			preview: false,
		},
	};
	let app = {
		renderFrame: function() {
			 requestAnimationFrame(app.renderFrame);
			 let count = settings.graphics.bars;
			 c.clearRect(0, 0, canvas.width, canvas.height);
			 for (let i = 1; i < settings.graphics.bars + 1; i++) {
			  c.beginPath();
			  c.fillStyle = 'black';
			  if (settings.mode.studio == false) {
				app.analyser.getByteFrequencyData(app.frequencyData);
				c.rect(window.innerWidth / 2 / count * i, innerHeight, 5, -app.frequencyData[i] * 10);
			  } else {
				c.rect(window.innerWidth / 2 / count * i, innerHeight, 5, -Math.floor(Math.random() * 250));
			  }
			  c.fill();
			  c.closePath();
			 }
		},
		start: function() {
			app.audioCtx = new AudioContext();
			app.audio = document.getElementById('myAudio');
			app.audioSrc = app.audioCtx.createMediaElementSource(app.audio);
			app.analyser = app.audioCtx.createAnalyser();
			app.frequencyData = new Uint8Array(app.analyser.frequencyBinCount);
			app.audioSrc.connect(app.audioCtx.destination);
			app.audioSrc.connect(app.analyser);
			app.renderFrame();
			setInterval( function() {
				settings.graphics.bars = document.getElementById('barAmount').value;
			}, 100);
			window.onresize = function() {
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
			}
		},
		audio: '',
		audioCtx: '',
		analyser: '',
		audioSrc: '',
		frequencyData: '',
	};
	app.start();
	/*
	
		let data;
		  var ctx = new AudioContext();
		  audio = document.getElementById('myAudio');
		  audio.crossOrigin = "anonymous";
		  var audioSrc = ctx.createMediaElementSource(audio);
		  var analyser = ctx.createAnalyser();
		  // we have to connect the MediaElementSource with the analyser 
		  audioSrc.connect(ctx.destination);
		  audioSrc.connect(analyser);
		  // we could configure the analyser: e.g. analyser.fftSize (for further infos read the spec)
		 
		  // frequencyBinCount tells you how many values you'll receive from the analyser
		  var frequencyData = new Uint8Array(analyser.frequencyBinCount);
		 
		  // we're ready to receive some data!
		  let count = 10;
		  // loop
		  function renderFrame() {
			 requestAnimationFrame(renderFrame);
			 // update data in frequencyData
			 data = analyser.getByteFrequencyData(frequencyData);
			 c.clearRect(0, 0, canvas.width, canvas.height);
			 for (let i = 1; i < count + 1; i++) {
			  c.beginPath();
			  c.fill = 'red';
			  c.fillRect(window.innerWidth / 2 / count * i, innerHeight - 50, 5, -Math.floor(Math.random() * 100));
			  c.closePath();
			 }
		  }
	*/
	</script>
</html>
